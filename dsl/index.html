



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Kotlin Multiplatform library to create state machines">
      
      
        <link rel="canonical" href="https://freeletics.github.com/flowredux/dsl/">
      
      
        <meta name="author" content="Freeletics">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/icon-freeletics.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>DSL - FlowRedux</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../css/app.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="black" data-md-color-accent="white">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#dsl" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://freeletics.github.com/flowredux/" title="FlowRedux" class="md-header-nav__button md-logo">
          
            <img src="../images/icon-freeletics.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              FlowRedux
            </span>
            <span class="md-header-nav__topic">
              
                DSL
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/freeletics/FlowRedux/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    FlowRedux
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://freeletics.github.com/flowredux/" title="FlowRedux" class="md-nav__button md-logo">
      
        <img src="../images/icon-freeletics.png" width="48" height="48">
      
    </a>
    FlowRedux
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/freeletics/FlowRedux/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    FlowRedux
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="FlowRedux" class="md-nav__link">
      FlowRedux
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        DSL
      </label>
    
    <a href="./" title="DSL" class="md-nav__link md-nav__link--active">
      DSL
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-state" class="md-nav__link">
    Initial State
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instate" class="md-nav__link">
    inState
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#onenter" class="md-nav__link">
    onEnter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#onaction" class="md-nav__link">
    on&lt;Action&gt;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#observewhileinstate" class="md-nav__link">
    observeWhileInState()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#observe" class="md-nav__link">
    observe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setstate" class="md-nav__link">
    SetState
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getstate" class="md-nav__link">
    GetState
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flatmappolicy" class="md-nav__link">
    FlatMapPolicy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practice" class="md-nav__link">
    Best Practice
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-recommended-way" class="md-nav__link">
    The recommended way
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../flow_vs_FlowReduxStateMachine/" title="FlowReduxStateMachine vs .reduxStore()" class="md-nav__link">
      FlowReduxStateMachine vs .reduxStore()
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../logging/" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../multiplatform/" title="Multiplatform" class="md-nav__link">
      Multiplatform
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Javadoc
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Javadoc
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1" type="checkbox" id="nav-7-1">
    
    <label class="md-nav__link" for="nav-7-1">
      Dsl
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-1">
        Dsl
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl.flow/" title="Com.freeletics.flowredux.dsl.flow" class="md-nav__link">
      Com.freeletics.flowredux.dsl.flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1-3" type="checkbox" id="nav-7-1-3">
    
    <label class="md-nav__link" for="nav-7-1-3">
      Alltypes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-7-1-3">
        Alltypes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/alltypes/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1-4" type="checkbox" id="nav-7-1-4">
    
    <label class="md-nav__link" for="nav-7-1-4">
      Com.freeletics.flowredux.dsl
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-7-1-4">
        Com.freeletics.flowredux.dsl
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-observer-block/" title="in state observer block" class="md-nav__link">
       in state observer block
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-on-enter-block/" title="in state on enter block" class="md-nav__link">
       in state on enter block
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-side-effect-builder/" title="in state side effect builder" class="md-nav__link">
       in state side effect builder
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-on-action-block/" title="on action block" class="md-nav__link">
       on action block
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-store-wide-builder-block/" title="store wide builder block" class="md-nav__link">
       store wide builder block
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-store-wide-observer-block/" title="store wide observer block" class="md-nav__link">
       store wide observer block
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1-4-8" type="checkbox" id="nav-7-1-4-8">
    
    <label class="md-nav__link" for="nav-7-1-4-8">
       flat map policy
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-7-1-4-8">
         flat map policy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flat-map-policy/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flat-map-policy/-c-o-n-c-a-t/" title="c o n c a t" class="md-nav__link">
       c o n c a t
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flat-map-policy/-l-a-t-e-s-t/" title="l a t e s t" class="md-nav__link">
       l a t e s t
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flat-map-policy/-m-e-r-g-e/" title="m e r g e" class="md-nav__link">
       m e r g e
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1-4-9" type="checkbox" id="nav-7-1-4-9">
    
    <label class="md-nav__link" for="nav-7-1-4-9">
       flow redux state machine
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-7-1-4-9">
         flow redux state machine
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-state-machine/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-state-machine/-init-/" title="init" class="md-nav__link">
       init 
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-state-machine/dispatch/" title="Dispatch" class="md-nav__link">
      Dispatch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-state-machine/spec/" title="Spec" class="md-nav__link">
      Spec
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-state-machine/state/" title="State" class="md-nav__link">
      State
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1-4-10" type="checkbox" id="nav-7-1-4-10">
    
    <label class="md-nav__link" for="nav-7-1-4-10">
       flow redux store builder
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-7-1-4-10">
         flow redux store builder
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-store-builder/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-store-builder/-init-/" title="init" class="md-nav__link">
       init 
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-store-builder/builder-blocks/" title="Builder blocks" class="md-nav__link">
      Builder blocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-store-builder/in-state/" title="In state" class="md-nav__link">
      In state
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-flow-redux-store-builder/observe/" title="Observe" class="md-nav__link">
      Observe
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1-4-11" type="checkbox" id="nav-7-1-4-11">
    
    <label class="md-nav__link" for="nav-7-1-4-11">
       in state builder block
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-7-1-4-11">
         in state builder block
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-builder-block/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-builder-block/-init-/" title="init" class="md-nav__link">
       init 
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-builder-block/_in-state-side-effect-builders/" title="in state side effect builders" class="md-nav__link">
       in state side effect builders
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-builder-block/_sub-state-class/" title="sub state class" class="md-nav__link">
       sub state class
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-builder-block/observe-while-in-state/" title="Observe while in state" class="md-nav__link">
      Observe while in state
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-builder-block/on-enter/" title="On enter" class="md-nav__link">
      On enter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-in-state-builder-block/on/" title="On" class="md-nav__link">
      On
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1-4-12" type="checkbox" id="nav-7-1-4-12">
    
    <label class="md-nav__link" for="nav-7-1-4-12">
       on action in state side effect builder
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-7-1-4-12">
         on action in state side effect builder
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-on-action-in-state-side-effect-builder/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-on-action-in-state-side-effect-builder/-init-/" title="init" class="md-nav__link">
       init 
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1-4-13" type="checkbox" id="nav-7-1-4-13">
    
    <label class="md-nav__link" for="nav-7-1-4-13">
       on enter in state side effect builder
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-7-1-4-13">
         on enter in state side effect builder
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-on-enter-in-state-side-effect-builder/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-on-enter-in-state-side-effect-builder/-init-/" title="init" class="md-nav__link">
       init 
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1-4-14" type="checkbox" id="nav-7-1-4-14">
    
    <label class="md-nav__link" for="nav-7-1-4-14">
       set state
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-7-1-4-14">
         set state
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-set-state/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-set-state/-init-/" title="init" class="md-nav__link">
       init 
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/-set-state/invoke/" title="Invoke" class="md-nav__link">
      Invoke
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1-4-15" type="checkbox" id="nav-7-1-4-15">
    
    <label class="md-nav__link" for="nav-7-1-4-15">
      Kotlinx.coroutines.flow. flow
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-7-1-4-15">
        Kotlinx.coroutines.flow. flow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/kotlinx.coroutines.flow.-flow/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/dsl/com.freeletics.flowredux.dsl/kotlinx.coroutines.flow.-flow/redux-store/" title="Redux store" class="md-nav__link">
      Redux store
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      Flowredux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        Flowredux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2-2" type="checkbox" id="nav-7-2-2">
    
    <label class="md-nav__link" for="nav-7-2-2">
      Alltypes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-7-2-2">
        Alltypes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/alltypes/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2-3" type="checkbox" id="nav-7-2-3">
    
    <label class="md-nav__link" for="nav-7-2-3">
      Com.freeletics.flowredux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-7-2-3">
        Com.freeletics.flowredux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/-reducer/" title="reducer" class="md-nav__link">
       reducer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/-side-effect/" title="side effect" class="md-nav__link">
       side effect
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/-state-accessor/" title="state accessor" class="md-nav__link">
       state accessor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2-3-5" type="checkbox" id="nav-7-2-3-5">
    
    <label class="md-nav__link" for="nav-7-2-3-5">
       flow redux logger
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-7-2-3-5">
         flow redux logger
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/-flow-redux-logger/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/-flow-redux-logger/log/" title="Log" class="md-nav__link">
      Log
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2-3-6" type="checkbox" id="nav-7-2-3-6">
    
    <label class="md-nav__link" for="nav-7-2-3-6">
       reducer exception
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-7-2-3-6">
         reducer exception
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/-reducer-exception/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/-reducer-exception/-init-/" title="init" class="md-nav__link">
       init 
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2-3-7" type="checkbox" id="nav-7-2-3-7">
    
    <label class="md-nav__link" for="nav-7-2-3-7">
      Kotlinx.coroutines.flow. flow
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-7-2-3-7">
        Kotlinx.coroutines.flow. flow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/kotlinx.coroutines.flow.-flow/" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Javadoc/flowredux/com.freeletics.flowredux/kotlinx.coroutines.flow.-flow/redux-store/" title="Redux store" class="md-nav__link">
      Redux store
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-state" class="md-nav__link">
    Initial State
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instate" class="md-nav__link">
    inState
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#onenter" class="md-nav__link">
    onEnter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#onaction" class="md-nav__link">
    on&lt;Action&gt;
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#observewhileinstate" class="md-nav__link">
    observeWhileInState()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#observe" class="md-nav__link">
    observe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setstate" class="md-nav__link">
    SetState
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getstate" class="md-nav__link">
    GetState
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flatmappolicy" class="md-nav__link">
    FlatMapPolicy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practice" class="md-nav__link">
    Best Practice
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-recommended-way" class="md-nav__link">
    The recommended way
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/freeletics/FlowRedux/edit/master/docs/dsl.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="dsl">DSL<a class="headerlink" href="#dsl" title="Permanent link">&para;</a></h1>
<p>FlowRedux provides a convenient DSL to describe your state machine.
This page introduces you the DSL that you can use.</p>
<p>To do that we will stick with a simple example of loading a list of items from a web service.
As you read this section and more concepts of the DSL will be introduced we will extend this sample.</p>
<p>For now to get started, let&rsquo;s define the <code>States</code> our state machine has.
As said before we loads a list of items from a web service
and display that list.
While loading the list we show a loading indicator on the screen and
if an error occurs we show an error message on the screen with a retry button.</p>
<p>This gives us the following states:</p>
<div class="codehilite"><pre><span></span><span class="k">sealed</span> <span class="k">class</span> <span class="nc">State</span> <span class="p">{</span>

    <span class="c1">// Shows a loading indicator on screen</span>
    <span class="k">object</span> <span class="nc">LoadingState</span> <span class="p">:</span> <span class="n">State</span><span class="p">()</span>

    <span class="c1">// List of items loaded successfully, show it on screen</span>
    <span class="k">data</span> <span class="k">class</span> <span class="nc">ShowContentState</span><span class="p">(</span><span class="k">val</span> <span class="py">items</span> <span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Item</span><span class="p">&gt;)</span> <span class="p">:</span> <span class="n">State</span><span class="p">()</span>

    <span class="c1">// Error while loading happened</span>
    <span class="k">data</span> <span class="k">class</span> <span class="nc">ErrorState</span><span class="p">(</span><span class="k">val</span> <span class="py">cause</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">:</span> <span class="n">State</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>

<p>If we reached <code>ErrorState</code> we display an error message but also a button a user can click to retry loading the items.
This gives us the following <code>Actions</code>:</p>
<div class="codehilite"><pre><span></span><span class="k">sealed</span> <span class="k">class</span> <span class="nc">Action</span> <span class="p">{</span>
    <span class="k">object</span> <span class="nc">RetryLoadingAction</span> <span class="p">:</span> <span class="n">Action</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>

<h2 id="initial-state">Initial State<a class="headerlink" href="#initial-state" title="Permanent link">&para;</a></h2>
<p>Every <code>FlowReduxStateMachine</code> needs an initial state.
This is in which state the state machine starts.
In our example we start with the <code>LoadingState</code>.</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="c1">// will be filled in next section</span>
            <span class="p">...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Please note the constructor parameter of <code>FlowReduxStateMachine(initialState = ...)</code>.
This is how you define the initial state of your state machine.
Next, we already see that we need an <code>init {...}</code> block containing a <code>spec { ... }</code> block inside.
The <code>spec { ... }</code> block is actually where we write our DSL inside.</p>
<h2 id="instate">inState<a class="headerlink" href="#instate" title="Permanent link">&para;</a></h2>
<p>The first concept we learn is <code>inState</code></p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
                <span class="p">...</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Please note that <code>inState</code> itself doesn&rsquo;t do anything.
All we did so far with <code>inState&lt;LoadingState&gt;</code> is set an entry point.
Next let&rsquo;s discuss what an <code>inState</code> can contain as triggers to actually &ldquo;do something&rdquo;:</p>
<ol>
<li><code>onEnter</code>: Triggers whenever we enter that state</li>
<li><code>on&lt;Action&gt;</code>: Triggers whenever we are in this state and the specified action is triggered from the outside by calling <code>FlowReduxStateMachine.dispatch(action)</code>.</li>
<li><code>observeWhileInState( flow )</code>: You can subscribe to any arbitarry <code>Flow</code> while your state machine is in that state.</li>
</ol>
<p>Let&rsquo;s try to go through them as we build our state machine:</p>
<h3 id="onenter">onEnter<a class="headerlink" href="#onenter" title="Permanent link">&para;</a></h3>
<p>What do we want to do when we enter the <code>LoadingState</code>?
We want to do the http request, right?
Let&rsquo;s do that by extending our example:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
                <span class="n">onEnter</span> <span class="p">{</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                    <span class="c1">// we entered the LoadingState, so let&#39;s do the http request</span>
                    <span class="k">try</span> <span class="p">{</span>
                        <span class="k">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="n">loadItems</span><span class="p">()</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ShowContentState</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="p">}</span>
                    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">t</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ErrorState</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>There are a some new things like  <code>onEnter</code>, <code>getState</code> and <code>setState</code>. We will cover <a href="#getstate">getState</a> and <a href="#setstate">setState</a> in dedicated sections.
All you have to know about <code>setState</code> for now is that this is the way to set the next state in your state machine.
Let&rsquo;s talk about <code>onEnter</code>:</p>
<ul>
<li><strong><code>onEnter { ... }</code> is running asynchronously in a coroutine</strong>.
That means whatever you do inside the <code>onEnter</code> block is not blocking anything else.
You can totally run here long running and expensive calls (like doing an http request).</li>
<li><strong><code>onEnter { ... }</code> doesn&rsquo;t get canceled</strong> when the state machine transitioned to another state original state. Example:
 <div class="codehilite"><pre><span></span><span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
   <span class="n">onEnter</span> <span class="p">{</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
       <span class="n">setState</span> <span class="p">{</span> <span class="n">ErrorState</span><span class="p">(</span><span class="n">Exception</span><span class="p">(</span><span class="s">&quot;Fake Exception&quot;</span><span class="p">)</span> <span class="p">}</span>
       <span class="n">doA</span><span class="p">()</span>
       <span class="n">doSomethingLongRunning</span><span class="p">()</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
 <code>doA()</code> and <code>doSomethingLongRunning()</code> are still executed even if <code>setState { ... }</code> which got executed before causes our state machine to move to the next state.
 The takeaway is: the full <code>onEnter { ... }</code> block will be executed once a state has been entered (there is an exception, we will talk about that in <a href="#flatmappolicy">FlatMapPolicy</a> section).</li>
</ul>
<h3 id="onaction">on<code>&lt;Action&gt;</code><a class="headerlink" href="#onaction" title="Permanent link">&para;</a></h3>
<p>How do we deal with external user input like clicks in FlowRedux? 
This is what Actions are for. 
In FlowRedux DSL you can react on Actions by using a <code>on&lt;MyAction&gt;{ ... }</code> block.</p>
<p>In our example we want to retry loading if we are in <code>ErrorState</code> and the user clicks on a retry button. 
Clicking on that button dispatches a <code>RetryLoadingAction</code> to our state machine.
Let&rsquo;s extend our FlowReduxStateMachine to react on such an action if the current state is <code>ErrorState</code>:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
                <span class="n">onEnter</span> <span class="p">{</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                    <span class="c1">// we entered the LoadingState, so let&#39;s do the http request</span>
                    <span class="k">try</span> <span class="p">{</span>
                        <span class="k">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="n">loadItems</span><span class="p">()</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ShowContentState</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="p">}</span>
                    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">t</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ErrorState</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// let&#39;s add a new inState{...} with an on{...} block ï˜Ž</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">ErrorState</span><span class="p">&gt;</span> <span class="p">{</span>
               <span class="n">on</span><span class="p">&lt;</span><span class="n">RetryLoadingAction</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">action</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="c1">// This block triggers if we are in ErrorState </span>
                  <span class="c1">// RetryLoadingAction has been dispatched to this state machine.</span>
                  <span class="c1">// In that case we transition to LoadingState which then starts the http</span>
                  <span class="c1">// request to load items.</span>

                  <span class="n">setState</span> <span class="p">{</span> <span class="n">LoadingState</span> <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>A <code>on { ... }</code> block gets 3 parameters:  <code>action</code> which is the actual instance of the <code>Action</code> that
triggered this block and <code>setState</code> and <code>getState</code> which you have also seen in <code>onEnter { ... }</code> block.
<code>on { ... }</code> is actually pretty similar to <code>onEnter {...}</code> just with a different &ldquo;trigger&rdquo; (action vs. entering a state).
Furthermore, <code>on { ... }</code> has the same characteristics as <code>onEnter { ... }</code>:</p>
<ul>
<li><strong><code>on&lt;MyAction&gt; { ... }</code> is running asynchronously in a coroutine</strong>.
You can totally run here long running and expensive calls (like doing an http request).</li>
<li><strong><code>on&lt;MyAction&gt; { ... }</code> doesn&rsquo;t get canceled</strong> when the state machine transitioned to another state original state.
See <a href="#onenter">onEnter</a> section for more details.</li>
</ul>
<h3 id="observewhileinstate">observeWhileInState()<a class="headerlink" href="#observewhileinstate" title="Permanent link">&para;</a></h3>
<p>This one is useful if you want to collect a <code>Flow</code> only while being exactly in that state.
To give a concrete example how this is useful let&rsquo;s extend our example from above.
Let&rsquo;s say whenever our state machine is in <code>ErrorState</code> we want to retry loading the items after
3 seconds in <code>ErrorState</code> or anytime before the 3 seconds have elapsed if the user clicks the retry button.
Furthermore the 3 seconds countdown timer should be displayed in our app:</p>
<p>To implement this let&rsquo;s first extend our <code>ErrorState</code>:</p>
<div class="codehilite"><pre><span></span><span class="k">data</span> <span class="k">class</span> <span class="nc">ErrorState</span><span class="p">(</span>
    <span class="k">val</span> <span class="py">cause</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">,</span>
    <span class="k">val</span> <span class="py">countdown</span> <span class="p">:</span> <span class="n">Int</span>    <span class="c1">// This value is decreased from 3 then 2 then 1 and represents the countdown value.</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">State</span><span class="p">()</span>
</pre></div>

<p>Now let&rsquo;s add some countdown capabilities to our state machine by using <code>observeWhileInState()</code>:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
                <span class="n">onEnter</span> <span class="p">{</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                    <span class="c1">// we entered the LoadingState, so let&#39;s do the http request</span>
                    <span class="k">try</span> <span class="p">{</span>
                        <span class="k">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="n">loadItems</span><span class="p">()</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ShowContentState</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="p">}</span>
                    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">t</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ErrorState</span><span class="p">(</span><span class="n">cause</span> <span class="p">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">countdown</span> <span class="p">=</span> <span class="m">3</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// Countdown starts with 3 seconds</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">inState</span><span class="p">&lt;</span><span class="n">ErrorState</span><span class="p">&gt;</span> <span class="p">{</span>
               <span class="n">on</span><span class="p">&lt;</span><span class="n">RetryLoadingAction</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">action</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="n">setState</span> <span class="p">{</span> <span class="n">LoadingState</span> <span class="p">}</span>
               <span class="p">}</span>

               <span class="k">val</span> <span class="py">timer</span> <span class="p">:</span> <span class="n">Flow</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">timerThatEmitsEverySecond</span><span class="p">()</span>
               <span class="n">observeWhileInState</span><span class="p">(</span><span class="n">timer</span><span class="p">)</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                    <span class="c1">// This block triggers every time the timer emits</span>
                    <span class="c1">// which happens every second</span>
                    <span class="k">val</span> <span class="py">state</span> <span class="p">=</span> <span class="n">getState</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="k">is</span> <span class="n">ErrorState</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">val</span> <span class="py">countdownTimeLeft</span> <span class="p">=</span> <span class="n">state</span><span class="p">.</span><span class="n">countdown</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">countdownTimeLeft</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                            <span class="n">setState</span> <span class="p">{</span> <span class="n">state</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">countdown</span> <span class="p">=</span> <span class="n">countdownTimeLeft</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">}</span> <span class="c1">//  decrease the countdown by 1 second</span>
                        <span class="k">else</span>
                            <span class="n">setState</span> <span class="p">{</span> <span class="n">LoadingState</span> <span class="p">}</span> <span class="c1">// transition to the LoadingState</span>
                    <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">timerThatEmitsEverySecond</span><span class="p">()</span> <span class="p">:</span> <span class="n">Flow</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="k">var</span> <span class="py">timeElapsed</span> <span class="p">=</span> <span class="m">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">isActive</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// is Flow still active?</span>
            <span class="n">delay</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span>     <span class="c1">// wait 1 second</span>
            <span class="n">timeElapsed</span><span class="p">++</span>
            <span class="n">emit</span><span class="p">(</span><span class="n">timeElapsed</span><span class="p">)</span> <span class="c1">// Flow Emits value</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Let&rsquo;s look at the source code above step by step.
Whenever we are in <code>LoadingState</code> and an error occurs while loading the items we go into
<code>ErrorState</code>. Nothing new.
What is new is that <code>ErrorState</code> contains an additional field  <code>countdown</code> which we set on
transitioning from <code>LoadingState</code> to <code>ErrorState(countdown = 3)</code> (means 3 seconds left).</p>
<p>We extend <code>inState&lt;ErrorState&gt; { ... }</code> block and add a <code>observeWhileInState(timer)</code>.
<code>timer</code> is a <code>Flow&lt;Int&gt;</code> that emits a new (incremented) number every second.
<code>observeWhileInState(timer)</code> calls <code>.collect {...}</code> on the timer flow and executes the block with the
parameters <code>value</code>, <code>getState</code> and <code>setState</code> every time <code>timer</code> emits a new value.
In other words: instead of calling <code>timer.collect { ... }</code> you call <code>observeWhileInState(timer) { ... }</code> to collect the Flow&rsquo;s values as long as the state machine is in that state.</p>
<p>But here is the deal: it automatically cancels the timer once the state machine transitioned away from
<code>ErrorState</code> into another state.
This happens either when the user clicks on the retry button and causes <code>on&lt;RetryLoadingAction&gt;</code> to be dispatched
or when 3 seconds have elapsed.
To keep track how many seconds are left we decrease <code>ErrorState.countdown</code> field after every second until we reached zero.
On zero we call <code>setState { LoadingState }</code> to do the state transition.</p>
<p><code>observeWhileInState(anyFlow) { value, getState, setState -&gt; ... }</code> has 3 parameters:
<code>value</code> is the value emitted by the flow, <a href="#getstate">getState</a> to get the current state and <a href="#setState">setState</a> to do a state transition.</p>
<p>In contrast to <code>onEnter</code> and <code>on&lt;Action&gt;</code> block <code>observeWhileInState()</code> block stops the execution once the state machine is not in the original <code>inState&lt;State&gt;</code> anymore.</p>
<h2 id="observe">observe<a class="headerlink" href="#observe" title="Permanent link">&para;</a></h2>
<p>If for whatever reason you want to trigger a state change out of  <code>inState&lt;&gt;</code>, <code>onEnter { ... }</code>, <code>on&lt;Action&gt;</code> or <code>observeWhileInState { ... }</code> by observing a <code>Flow</code> then <code>observe</code> is what you are looking for:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
                <span class="n">onEnter</span> <span class="p">{</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="p">...</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">inState</span><span class="p">&lt;</span><span class="n">ErrorState</span><span class="p">&gt;</span> <span class="p">{</span>
               <span class="n">on</span><span class="p">&lt;</span><span class="n">RetryLoadingAction</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">action</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="p">...</span>
               <span class="p">}</span>

               <span class="n">observeWhileInState</span><span class="p">(</span><span class="n">timer</span><span class="p">)</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="p">...</span>
               <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">val</span> <span class="py">aFlow</span> <span class="p">:</span> <span class="n">Flow</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">flowOf</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)</span>
            <span class="n">observe</span><span class="p">(</span> <span class="n">aFlow</span> <span class="p">)</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                <span class="c1">// Will trigger anytime flow emits a value</span>
                <span class="p">...</span>
            <span class="p">}</span>

            <span class="n">observe</span><span class="p">(</span> <span class="n">anotherFlow</span> <span class="p">)</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                <span class="c1">// Will trigger anytime flow emits a value</span>
               <span class="p">...</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><code>observe()</code> is like <code>observeWhileInState()</code> just that it is not bound to the current state like <code>observeWhileInState()</code> is.
<code>observe()</code> will stop collecting the passed in Flow only if the CoroutineScope of the whole FlowReduxStateMachine gets canceled.</p>
<h2 id="setstate">SetState<a class="headerlink" href="#setstate" title="Permanent link">&para;</a></h2>
<p>As you probably have already noticed from the sections above <code>setState</code> is a way to make you state machine transition to another state.
You can think of <code>SetState</code> as a function that gets the current state as input parameter and returns
the new State:</p>
<div class="codehilite"><pre><span></span><span class="k">fun</span> <span class="nf">setState</span> <span class="p">(</span><span class="n">currentState</span> <span class="p">:</span> <span class="n">State</span><span class="p">)</span> <span class="p">:</span> <span class="n">State</span> <span class="p">{</span>
    <span class="k">val</span> <span class="py">newState</span> <span class="p">:</span> <span class="n">State</span> <span class="p">=</span>  <span class="p">...</span> <span class="c1">// compute new state somehow</span>
    <span class="k">return</span> <span class="n">newState</span>
<span class="p">}</span>
</pre></div>

<p>Due to some kotlin language restriction <code>SetState</code> is actually a <code>class</code> and not just a function but that doesn&rsquo;t have to bother you as it is an implementation detail of FlowRedux.
You can totally think of it as a function <code>(State) -&gt; State</code>.</p>
<p>One important thing you have to know about FlowRedux in general is that FlowRedux is running async.
That means that there might be multiple <code>setState { ... }</code> in the queue trying to change the state (but only 1 SetState will be actually executed at the same time).</p>
<p>This means that it is possible that on <code>setState { ... }</code> execution the state is actually not in the same state anymore as you would have expected.
Per default FlowRedux will check if the state is still the expected one and if it isn&rsquo;t <code>setState {...}</code> wont run.</p>
<p>If you want to override this behavior you can do that by providing an additional parameter <code>runIf</code> and return true if FlowRedux should run setState, otherwise false.</p>
<div class="codehilite"><pre><span></span><span class="n">setState</span><span class="p">(</span><span class="n">runIf</span> <span class="p">=</span> <span class="p">{</span> <span class="n">currentState</span> <span class="p">-&gt;</span> <span class="n">currentState</span> <span class="k">is</span> <span class="n">FooState</span> <span class="p">})</span> <span class="p">{</span> <span class="n">currentState</span> <span class="p">-&gt;</span>
    <span class="c1">// executed only if runIf returns true</span>
    <span class="n">OtherState</span>
<span class="p">}</span>
</pre></div>

<p>For example if you want to force setState to run always you can do the following:</p>
<div class="codehilite"><pre><span></span><span class="n">setState</span><span class="p">(</span><span class="n">runIf</span> <span class="p">=</span> <span class="p">{</span> <span class="k">true</span> <span class="p">})</span> <span class="p">{</span> <span class="n">currentState</span> <span class="p">-&gt;</span>
    <span class="n">OtherState</span>
<span class="p">}</span>
</pre></div>

<h2 id="getstate">GetState<a class="headerlink" href="#getstate" title="Permanent link">&para;</a></h2>
<p>If you need in any block the current state <code>GetState</code> is your friend.
It is actually just a function that you can invoke that returns you the current state of your state machine.</p>
<h2 id="flatmappolicy">FlatMapPolicy<a class="headerlink" href="#flatmappolicy" title="Permanent link">&para;</a></h2>
<p>Have you ever wondered what would happen if you would execute <code>Action</code> very fast 1 after another?
For example:</p>
<div class="codehilite"><pre><span></span><span class="n">spec</span> <span class="p">{</span>
    <span class="n">inState</span><span class="p">&lt;</span><span class="n">FooState</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="n">on</span><span class="p">&lt;</span><span class="n">BarAction</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
            <span class="n">delay</span><span class="p">(</span><span class="m">5000</span><span class="p">)</span> <span class="c1">// wait for 5000 seconds</span>
            <span class="n">setState</span> <span class="p">{</span> <span class="n">OtherState</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The example above shows a problem with async. state machines like FlowRedux:
If we our state machine is in <code>FooState</code> and a <code>BarAction</code> got triggered, we wait for 5 seconds and then set the state to another state.
What if while waiting 5 seconds (i.e. let&rsquo;s say after 3 seconds of waiting) another <code>BarAction</code> gets triggered.
That is possible right?
With <code>FlatMapPolicy</code> you can specify what should happen in that case.
There are three options to choose from:</p>
<ul>
<li><code>LATEST</code>: This is the default one. It would cancel any previous execution and just run the latest one.
In the example above it would mean while waiting 5 seconds another <code>BarAction</code> gets triggered, the first execution of <code>on&lt;BarAction&gt;</code> block gets stopped and a new <code>on&lt;BarAction&gt;</code> block starts.</li>
<li><code>MERGE</code>: Choosing this causes all the blocks to continue running but there are no guarantees in which order. For example:
<div class="codehilite"><pre><span></span><span class="n">spec</span> <span class="p">{</span>
    <span class="n">inState</span><span class="p">&lt;</span><span class="n">FooState</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="n">on</span><span class="p">&lt;</span><span class="n">BarAction</span><span class="p">&gt;(</span><span class="n">flatMapPolicy</span> <span class="p">=</span> <span class="n">FlapMapPolicy</span><span class="p">.</span><span class="n">MERGE</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
            <span class="n">delay</span><span class="p">(</span> <span class="n">randomInt</span><span class="p">()</span> <span class="p">)</span> <span class="c1">// wait for some random time</span>
            <span class="n">setState</span> <span class="p">{</span> <span class="n">OtherState</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
Let&rsquo;s assume that  we trigger two times <code>BarAction</code>.
We use random amount of seconds for waiting.
Since we use <code>MERGE</code> <code>on&lt;BarAction&gt;</code> block gets executed 2 times without canceling the previous one (that is the difference to <code>LATEST</code>).
Moreover, <code>MERGE</code> doesn&rsquo;t make any promise on order of execution of the block (see <code>CONCAT</code> if you need promises on order).
So if <code>on&lt;BarAction&gt;</code> gets executed two times it will run in parallel and the the second execution could complete before the first execution (because using a random time of waiting).</li>
<li><code>CONCAT</code>: In contrast to <code>MERGE</code> and <code>LATEST</code> <code>CONCAT</code> will not run <code>on&lt;BarAction&gt;</code> in parallel and will not cancel any previous execution. Instead, <code>CONCAT</code> will preserve the order and execute one block after another.</li>
</ul>
<p>All execution blocks can specify a <code>FlatMapPolicy</code>:</p>
<ul>
<li><code>on&lt;Action&gt;(flatMapPolicy = FlatMapPolicy.LATEST){... }</code></li>
<li><code>onEnter(flatMapPolicy = FlatMapPolicy.LATEST) { ... }</code></li>
<li><code>observeWhileInState(flatMapPolicy = FlatMapPolicy.LATEST) { ... }</code></li>
</ul>
<h2 id="best-practice">Best Practice<a class="headerlink" href="#best-practice" title="Permanent link">&para;</a></h2>
<p>One very important aspect of the DSL is to provide a readable and maintainable way to reason about your state machine.
Let&rsquo; take a look at our example state machine:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
                <span class="n">onEnter</span> <span class="p">{</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                    <span class="c1">// we entered the LoadingState, so let&#39;s do the http request</span>
                    <span class="k">try</span> <span class="p">{</span>
                        <span class="k">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="n">loadItems</span><span class="p">()</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ShowContentState</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="p">}</span>
                    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">t</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">setState</span> <span class="p">{</span> <span class="n">ErrorState</span><span class="p">(</span><span class="n">cause</span> <span class="p">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">countdown</span> <span class="p">=</span> <span class="m">3</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// Countdown starts with 3 seconds</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">inState</span><span class="p">&lt;</span><span class="n">ErrorState</span><span class="p">&gt;</span> <span class="p">{</span>
               <span class="n">on</span><span class="p">&lt;</span><span class="n">RetryLoadingAction</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">action</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="n">setState</span> <span class="p">{</span> <span class="n">LoadingState</span> <span class="p">}</span>
               <span class="p">}</span>

               <span class="k">val</span> <span class="py">timer</span> <span class="p">:</span> <span class="n">Flow</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">timerThatEmitsEverySecond</span><span class="p">()</span>
               <span class="n">observeWhileInState</span><span class="p">(</span><span class="n">timer</span><span class="p">)</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span> <span class="n">getState</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                    <span class="c1">// This block triggers every time the timer emits</span>
                    <span class="c1">// which happens every second</span>
                    <span class="k">val</span> <span class="py">state</span> <span class="p">=</span> <span class="n">getState</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="k">is</span> <span class="n">ErrorState</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">val</span> <span class="py">countdownTimeLeft</span> <span class="p">=</span> <span class="n">state</span><span class="p">.</span><span class="n">countdown</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">countdownTimeLeft</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                            <span class="n">setState</span> <span class="p">{</span> <span class="n">state</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">countdown</span> <span class="p">=</span> <span class="n">countdownTimeLeft</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">}</span> <span class="c1">//  decrease the countdown by 1 second</span>
                        <span class="k">else</span>
                            <span class="n">setState</span> <span class="p">{</span> <span class="n">LoadingState</span> <span class="p">}</span> <span class="c1">// transition to the LoadingState</span>
                    <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">timerThatEmitsEverySecond</span><span class="p">()</span> <span class="p">:</span> <span class="n">Flow</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="k">var</span> <span class="py">timeElapsed</span> <span class="p">=</span> <span class="m">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">isActive</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// is Flow still active?</span>
            <span class="n">delay</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span>     <span class="c1">// wait 1 second</span>
            <span class="n">timeElapsed</span><span class="p">++</span>
            <span class="n">emit</span><span class="p">(</span><span class="n">timeElapsed</span><span class="p">)</span> <span class="c1">// Flow Emits value</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Do you notice something?
With more blocks we add the state machine itself gets harder to read, understand and maintain.
What we are aiming for with the DSL is an overview about what the state machine is supposed to do on a high level that reads like as specification.
If you take a look at the example from above, however, you will notice that it isn&rsquo;t easy to read and get bloated with implementation details.</p>
<h3 id="the-recommended-way">The recommended way<a class="headerlink" href="#the-recommended-way" title="Permanent link">&para;</a></h3>
<p>We recommend to keep the DSL really short, expressive, readable and maintainable.
Therefore instead of having implementation details in your DSL we recommend to use function references instead.
Let&rsquo;s refactor the example above to reflect this idea:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MyStateMachine</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">val</span> <span class="py">httpClient</span><span class="p">:</span> <span class="n">HttpClient</span>
<span class="p">)</span> <span class="p">:</span> <span class="n">FlowReduxStateMachine</span><span class="p">&lt;</span><span class="n">State</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;(</span><span class="n">initialState</span> <span class="p">=</span> <span class="n">LoadingState</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">//</span>
    <span class="c1">// This is the specification of your state machine. Less implementation details, better readability.</span>
    <span class="c1">//</span>
    <span class="n">init</span> <span class="p">{</span>
        <span class="n">spec</span> <span class="p">{</span>
            <span class="n">inState</span><span class="p">&lt;</span><span class="n">LoadingState</span><span class="p">&gt;</span> <span class="p">{</span>
                <span class="n">onEnter</span><span class="p">(</span><span class="o">::</span><span class="n">loadItemsAndMoveToContentOrErrorState</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="n">inState</span><span class="p">&lt;</span><span class="n">ErrorState</span><span class="p">&gt;</span> <span class="p">{</span>
               <span class="n">on</span><span class="p">&lt;</span><span class="n">RetryLoadingAction</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">setState</span> <span class="p">-&gt;</span>
                  <span class="c1">// For a single line statement it&#39;s fine to keep it as a block instead of moving to a function reference</span>
                  <span class="n">setState</span> <span class="p">{</span> <span class="n">LoadingState</span> <span class="p">}</span>
               <span class="p">}</span>

               <span class="n">observeWhileInState</span><span class="p">(</span>
                    <span class="n">timerThatEmitsEverySecond</span><span class="p">(),</span>
                    <span class="o">::</span><span class="n">onSecondElapsedMoveToLoadingStateOrMoveToDecrementCountdown</span>
               <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>


    <span class="c1">//</span>
    <span class="c1">// All the implementation details are in the functions below.</span>
    <span class="c1">//</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">loadItemsAndMoveToContentOrErrorState</span><span class="p">(</span><span class="n">getState</span> <span class="p">:</span> <span class="n">StateAccessor</span><span class="p">&lt;</span><span class="n">State</span><span class="p">&gt;,</span> <span class="n">setState</span> <span class="p">:</span> <span class="n">SetState</span><span class="p">&lt;</span><span class="n">State</span><span class="p">&gt;){</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="n">loadItems</span><span class="p">()</span>
            <span class="n">setState</span> <span class="p">{</span> <span class="n">ShowContentState</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">t</span> <span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">setState</span> <span class="p">{</span> <span class="n">ErrorState</span><span class="p">(</span><span class="n">cause</span> <span class="p">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">countdown</span> <span class="p">=</span> <span class="m">3</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// Countdown starts with 3 seconds</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">onSecondElapsedMoveToLoadingStateOrMoveToDecrementCountdown</span><span class="p">(</span>
        <span class="n">value</span> <span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
        <span class="n">getState</span> <span class="p">:</span> <span class="n">StateAccessor</span><span class="p">&lt;</span><span class="n">State</span><span class="p">&gt;,</span>
        <span class="n">setState</span> <span class="p">:</span> <span class="n">SetState</span><span class="p">&lt;</span><span class="n">State</span><span class="p">&gt;</span>
    <span class="p">){</span>
        <span class="k">val</span> <span class="py">state</span> <span class="p">=</span> <span class="n">getState</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="k">is</span> <span class="n">ErrorState</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">val</span> <span class="py">countdownTimeLeft</span> <span class="p">=</span> <span class="n">state</span><span class="p">.</span><span class="n">countdown</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">countdownTimeLeft</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="n">setState</span> <span class="p">{</span> <span class="n">state</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">countdown</span> <span class="p">=</span> <span class="n">countdownTimeLeft</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">}</span> <span class="c1">//  decrease the countdown by 1 second</span>
            <span class="k">else</span>
                <span class="n">setState</span> <span class="p">{</span> <span class="n">LoadingState</span> <span class="p">}</span> <span class="c1">// transition to the LoadingState</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">timerThatEmitsEverySecond</span><span class="p">()</span> <span class="p">:</span> <span class="n">Flow</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="k">var</span> <span class="py">timeElapsed</span> <span class="p">=</span> <span class="m">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">isActive</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// is Flow still active?</span>
            <span class="n">delay</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span>     <span class="c1">// wait 1 second</span>
            <span class="n">timeElapsed</span><span class="p">++</span>
            <span class="n">emit</span><span class="p">(</span><span class="n">timeElapsed</span><span class="p">)</span> <span class="c1">// Flow Emits value</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>By using function references you can read the DSL better and can zoom in into implementation
details anytime you want to by looking into a function body.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../contributing/" title="Contributing" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Contributing
              </span>
            </div>
          </a>
        
        
          <a href="../flow_vs_FlowReduxStateMachine/" title="FlowReduxStateMachine vs .reduxStore()" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                FlowReduxStateMachine vs .reduxStore()
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Freeletics.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>